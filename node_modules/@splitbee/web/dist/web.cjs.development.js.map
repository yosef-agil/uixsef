{"version":3,"file":"web.cjs.development.js","sources":["../src/index.ts"],"sourcesContent":["import { QueueData, Splitbee, SplitbeeOptions } from './types';\n\nconst isBrowser = typeof window !== 'undefined';\nconst SCRIPT_URL = 'https://cdn.splitbee.io/sb.js';\nlet queue: Array<QueueData> = [];\n\nconst handleLoad = () => {\n  if (isBrowser && !window.splitbee) return;\n  splitbee.track = window.splitbee.track;\n  splitbee.user = window.splitbee.user;\n  splitbee.enableCookie = window.splitbee.enableCookie;\n  splitbee.reset = window.splitbee.reset;\n\n  queue.forEach(ev => {\n    if (ev.type === 'track') window.splitbee.track.apply(null, ev.payload);\n    else if (ev.type === 'user')\n      window.splitbee.user.set.apply(null, ev.payload);\n    else if (ev.type === 'enableCookie')\n      window.splitbee.enableCookie.apply(null, ev.payload);\n    else if (ev.type === 'reset') window.splitbee.reset();\n  });\n\n  queue = [];\n};\n\nconst createAddToQueue = (type: QueueData['type']) => async (...args: any) => {\n  queue.push({ type: type, payload: args });\n  if (isBrowser && window.splitbee) {\n    handleLoad();\n  }\n};\n\nconst initSplitbee = (options?: SplitbeeOptions) => {\n  if (!isBrowser || window.splitbee) return;\n\n  const document = window.document;\n  const scriptUrl = options?.scriptUrl ? options.scriptUrl : SCRIPT_URL;\n\n  const injectedScript = document.querySelector(\n    `script[src='${scriptUrl}']`\n  ) as HTMLScriptElement | null;\n\n  if (injectedScript) {\n    injectedScript.onload = handleLoad;\n    return;\n  }\n\n  const script = document.createElement('script');\n  script.src = scriptUrl;\n  script.async = true;\n\n  if (options) {\n    if (options.apiUrl) script.dataset.api = options.apiUrl;\n    if (options.token) script.dataset.token = options.token;\n    if (options.disableCookie) script.dataset.noCookie = '1';\n  }\n\n  script.onload = handleLoad;\n\n  document.head.appendChild(script);\n};\n\nconst splitbee: Splitbee = {\n  track: createAddToQueue('track'),\n  user: {\n    set: createAddToQueue('user'),\n  },\n  init: initSplitbee,\n  enableCookie: createAddToQueue('enableCookie'),\n  reset: createAddToQueue('reset'),\n};\n\nexport default splitbee;\n"],"names":["isBrowser","window","SCRIPT_URL","queue","handleLoad","splitbee","track","user","enableCookie","reset","forEach","ev","type","apply","payload","set","createAddToQueue","args","push","initSplitbee","options","document","scriptUrl","injectedScript","querySelector","onload","script","createElement","src","async","apiUrl","dataset","api","token","disableCookie","noCookie","head","appendChild","init"],"mappings":"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"}