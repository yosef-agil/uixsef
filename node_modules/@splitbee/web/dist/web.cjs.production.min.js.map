{"version":3,"file":"web.cjs.production.min.js","sources":["../src/index.ts"],"sourcesContent":["import { QueueData, Splitbee, SplitbeeOptions } from './types';\n\nconst isBrowser = typeof window !== 'undefined';\nconst SCRIPT_URL = 'https://cdn.splitbee.io/sb.js';\nlet queue: Array<QueueData> = [];\n\nconst handleLoad = () => {\n  if (isBrowser && !window.splitbee) return;\n  splitbee.track = window.splitbee.track;\n  splitbee.user = window.splitbee.user;\n  splitbee.enableCookie = window.splitbee.enableCookie;\n  splitbee.reset = window.splitbee.reset;\n\n  queue.forEach(ev => {\n    if (ev.type === 'track') window.splitbee.track.apply(null, ev.payload);\n    else if (ev.type === 'user')\n      window.splitbee.user.set.apply(null, ev.payload);\n    else if (ev.type === 'enableCookie')\n      window.splitbee.enableCookie.apply(null, ev.payload);\n    else if (ev.type === 'reset') window.splitbee.reset();\n  });\n\n  queue = [];\n};\n\nconst createAddToQueue = (type: QueueData['type']) => async (...args: any) => {\n  queue.push({ type: type, payload: args });\n  if (isBrowser && window.splitbee) {\n    handleLoad();\n  }\n};\n\nconst initSplitbee = (options?: SplitbeeOptions) => {\n  if (!isBrowser || window.splitbee) return;\n\n  const document = window.document;\n  const scriptUrl = options?.scriptUrl ? options.scriptUrl : SCRIPT_URL;\n\n  const injectedScript = document.querySelector(\n    `script[src='${scriptUrl}']`\n  ) as HTMLScriptElement | null;\n\n  if (injectedScript) {\n    injectedScript.onload = handleLoad;\n    return;\n  }\n\n  const script = document.createElement('script');\n  script.src = scriptUrl;\n  script.async = true;\n\n  if (options) {\n    if (options.apiUrl) script.dataset.api = options.apiUrl;\n    if (options.token) script.dataset.token = options.token;\n    if (options.disableCookie) script.dataset.noCookie = '1';\n  }\n\n  script.onload = handleLoad;\n\n  document.head.appendChild(script);\n};\n\nconst splitbee: Splitbee = {\n  track: createAddToQueue('track'),\n  user: {\n    set: createAddToQueue('user'),\n  },\n  init: initSplitbee,\n  enableCookie: createAddToQueue('enableCookie'),\n  reset: createAddToQueue('reset'),\n};\n\nexport default splitbee;\n"],"names":["isBrowser","window","queue","handleLoad","splitbee","track","user","enableCookie","reset","forEach","ev","type","apply","payload","set","createAddToQueue","args","push","init","options","document","scriptUrl","injectedScript","querySelector","onload","script","createElement","src","async","apiUrl","dataset","api","token","disableCookie","noCookie","head","appendChild"],"mappings":"oEAEA,IAAMA,EAA8B,oBAAXC,OAErBC,EAA0B,GAExBC,EAAa,WACbH,IAAcC,OAAOG,WACzBA,EAASC,MAAQJ,OAAOG,SAASC,MACjCD,EAASE,KAAOL,OAAOG,SAASE,KAChCF,EAASG,aAAeN,OAAOG,SAASG,aACxCH,EAASI,MAAQP,OAAOG,SAASI,MAEjCN,EAAMO,SAAQ,SAAAC,GACI,UAAZA,EAAGC,KAAkBV,OAAOG,SAASC,MAAMO,MAAM,KAAMF,EAAGG,SACzC,SAAZH,EAAGC,KACVV,OAAOG,SAASE,KAAKQ,IAAIF,MAAM,KAAMF,EAAGG,SACrB,iBAAZH,EAAGC,KACVV,OAAOG,SAASG,aAAaK,MAAM,KAAMF,EAAGG,SACzB,UAAZH,EAAGC,MAAkBV,OAAOG,SAASI,WAGhDN,EAAQ,KAGJa,EAAmB,SAACJ,oDAAsCK,2BAAAA,yBAC9Dd,EAAMe,KAAK,CAAEN,KAAMA,EAAME,QAASG,IAC9BhB,GAAaC,OAAOG,UACtBD,2DAkCEC,EAAqB,CACzBC,MAAOU,EAAiB,SACxBT,KAAM,CACJQ,IAAKC,EAAiB,SAExBG,KAnCmB,SAACC,MACfnB,IAAaC,OAAOG,cAEnBgB,EAAWnB,OAAOmB,SAClBC,EAAYF,MAAAA,GAAAA,EAASE,UAAYF,EAAQE,UAjC9B,gCAmCXC,EAAiBF,EAASG,6BACfF,WAGbC,EACFA,EAAeE,OAASrB,WAIpBsB,EAASL,EAASM,cAAc,UACtCD,EAAOE,IAAMN,EACbI,EAAOG,OAAQ,EAEXT,IACEA,EAAQU,SAAQJ,EAAOK,QAAQC,IAAMZ,EAAQU,QAC7CV,EAAQa,QAAOP,EAAOK,QAAQE,MAAQb,EAAQa,OAC9Cb,EAAQc,gBAAeR,EAAOK,QAAQI,SAAW,MAGvDT,EAAOD,OAASrB,EAEhBiB,EAASe,KAAKC,YAAYX,MAS1BlB,aAAcQ,EAAiB,gBAC/BP,MAAOO,EAAiB"}